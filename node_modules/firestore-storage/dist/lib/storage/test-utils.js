"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createFirestoreTests = void 0;
const env = require("node-env-file");
const fs = require("fs");
const firestore_1 = require("@google-cloud/firestore");
const rules_unit_testing_1 = require("@firebase/rules-unit-testing");
const path = __dirname + '/../../../.env';
if (fs.existsSync(path)) {
    env(path);
}
function createFirestoreTests(context, setup) {
    let app;
    context.beforeEach(async () => {
        app = await (0, rules_unit_testing_1.initializeTestEnvironment)({
            projectId: 'firestore-storage-local',
        });
        await app.clearFirestore();
        const firestore = new firestore_1.Firestore({
            projectId: app.projectId,
            host: app.emulators.firestore.host,
            port: app.emulators.firestore.port,
            ssl: false,
        });
        await setup(firestore);
    });
    context.afterEach(async () => {
        if (app) {
            await app.cleanup();
        }
    });
}
exports.createFirestoreTests = createFirestoreTests;
//# sourceMappingURL=test-utils.js.map